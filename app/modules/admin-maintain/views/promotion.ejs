 <%- include('../../../templates/admin-navbar.ejs') -%>


  <!-- Content Wrapper. Contains page content -->

 <div class="content-wrapper">
     <!-- Content Header (Page header) -->
     <section class="content-header">
       <h1>

         <small>Note: Promo will automatically deactivated on its due date.</small>
       </h1>
       <ol class="breadcrumb">
         <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
         <li><a href="#">Maintenance</a></li>
         <li class="active">Promotions</li>
       </ol>
     </section>

     <!-- Main content -->
     <section class="content">
       <div class="row">
         <div class="col-xs-12">
           <div class="box">
             <div class="box-header">
               <h4 align="center">Promotions</h4>
             </div>
 			<!-- buttons -->
 				&nbsp; &nbsp;<button type="button" class="large ui green button" data-toggle="modal" data-target="#addPromotion"><i class="fa fa-plus"></i> Add New Promo</button>
             <!-- /.box-header -->
             <div class="box-body table-responsive">
               <table id="example2" class="table table-bordered table-hover">
                 <thead>
                 <tr>

                   <th>Product Name</th>
                   <th>Discount</th>
                   <th>Promo Date Due</th>
 				           <th>Status</th>
                   <th>Actions</th>
                 </tr>
                 </thead>
                 <tbody>
                  <% if (re == null || re == undefined){ %>

                  <% }else if(re.length == 0){ %>

                  <% }else{ %>
                    <% re.forEach(function(i){ %>
                      <tr>

                        <td><%=i.strPromoName%></td>
                        <td><%=i.discount%> %</td>
                        <td><%= moment(i.date_end).format("MM/DD/YYYY")%></td>
      				          <td>
                          <% if (i.intStatus == 1){ %>
                            <button data-no="<%=i.intPromoNo%>" class="ui toggle button active inactivate_promo">Active</button>

                          <% }else{ %>
                            <button data-no="<%=i.intPromoNo%>" class="ui toggle button inactive activate_promo">Inactive</button>
                          <% } %>
                        </td>
                        <td>
                          <a href=""><button class="btn btn-default btn-sm">Description</button></a>
                          <a href="/maintenance/promotionList?promo=<%=i.intPromoNo%>"><button class="btn btn-primary btn-sm">Product List</button></a>
                        </td>
                      </tr>
                    <% }) %>
                  <% } %>


                 </tbody>

               </table>
             </div>
             <!-- /.box-body -->
           </div>
           <!-- /.box -->

 	    </div>
         <!-- /.col -->
       </div>
       <!-- /.row -->
     </section>
     <!-- /.content -->
 </div>

   <!-- /.content-wrapper -->

   <!-- Modals -->

 	<div class="modal fade" id="addPromotion">
 	  <div class="modal-dialog">
 		<div class="modal-content">
 		  <div class="modal-header">
 			<button type="button" class="close" data-dismiss="modal" aria-label="Close">
 			  <span aria-hidden="true">&times;</span></button>
 			<h4 class="modal-title"></h4>
 		  </div>
 		  <div class="modal-body">
 			<!-- Horizontal Form -->

 					<!-- form start -->
          <% num = "1000"; %>
          <% if (lastpromo == null || lastpromo == undefined){ %>

          <% }else if (lastpromo.length == 0){ %>

          <% }else{ %>
            <% num = parseInt(lastpromo[0].intPromoNo) + 1; %>
          <% } %>
           <form role="form">
               <div class="box-body">
                 <div class="form-group">
                   <input type="hidden" id="pno" value="<%=num%>">
                   <label for="pname">Promo Name:</label>
                   <input type="text" required class="form-control" id="pname" placeholder="">
                 </div>

                 <div class="form-group">
                   <label for="pdesc">Promo Description:</label>
                   <textarea class="form-control" id="pdesc" placeholder=""></textarea>
                 </div>


                 <label>Discount:</label>
                 <div class="input-group col-xs-6">

                   <input type="number" required class="form-control" id="pdiscount" >
                   <span class="input-group-addon">%</span>

                 </div>
                 <br>
                 <div class="form-group">
                   <label for="pdue">Due Date</label>
                   <input type="date" required class="form-control" id="pdue" >

                 </div>

               </div>
             </form>

 		  </div>
 		  <div class="modal-footer">
 			<button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
 			<button type="button" id="save" class="btn btn-primary">Save</button>
 		  </div>
 		</div>
 		<!-- /.modal-content -->
 	</div>
   <!-- /.modal-dialog -->
 </div>

 <%- include('../../../templates/admin-aside.ejs') -%>

 <!-- ./wrapper -->

 <!-- REQUIRED JS SCRIPTS -->

<%- include('../../../templates/admin-footer.ejs') -%>

 <!-- page script (new added) -->
 <script>
   $(function () {
     $('#example2').DataTable({
       'paging'      : true,
       'lengthChange': true,
       'searching'   : true,
       'ordering'    : true,
       'info'        : true,
       'autoWidth'   : true,
 	  'select'		: true,
 	  'scroll'		: true
     })
   })
 </script>

 <script>
 $(document).ready(function(){

  $('#save').on('click',function(){
    $.ajax({
      url: '/maintenance/addPromotion',
      method: 'POST',
      datatype: "json",
      data: {
        pno: $('#pno').val(),
        pcode: $('#pcode').val(),
        pname: $('#pname').val(),
        pdesc: $('#pdesc').val(),
        pdiscount: $('#pdiscount').val(),
        pdue: $('#pdue').val()

      },
      success: function(response,status,http){
        if (response){
          if (response == "yes"){
            confirm_alert();
          }
        }
      }
    });
  });


 })
 </script>


<script>
  $('#title').html("USG | Promotions");
  $(".treeview a:contains('Maintenance')").parent().addClass("active");
  $(".navi a:contains('Promotions')").parent().addClass("active");
</script>

<script>
$('.inactivate_promo').on('click',function(){
  $(this).removeClass("ui toggle button active inactivate_promo").addClass("ui toggle button  activate_promo").html("Inactive");

  $.ajax({
    url: '/maintenance/inactivatePromo',
    method: 'post',
    datatype: 'json',
    data: {no: $(this).data('no')},
    success: function(response,status,http){
      if (response){
        swal("Success!", "You have activated Promo no"+$(this).data('no'), "success");
      }
    }
  })
})

$('.activate_promo').on('click',function(){
  $(this).removeClass("ui toggle button activate_promo").addClass("ui toggle button active inactivate_promo").html("Active");

  $.ajax({
    url: '/maintenance/activatePromo',
    method: 'post',
    datatype: 'json',
    data: {no: $(this).data('no')},
    success: function(response,status,http){
      if (response){
        swal("Success!", "You have activated Promo no"+$(this).data('no'), "success");
      }
    }
  })
})
</script>


 <!-- Optionally, you can add Slimscroll and FastClick plugins.
      Both of these plugins are recommended to enhance the
      user experience. -->
 </body>
 </html>
