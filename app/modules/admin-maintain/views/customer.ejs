<%- include('../../../templates/admin-navbar.ejs') -%>

 <!-- Content Wrapper. Contains page content -->

<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h3>
        Customers
      </h3>
      <h1>

        <small>Note: You are only allowed to block and edit customer information.</small>
      </h1>
      <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
        <li><a href="#">Maintenance</a></li>
        <li class="active">Customers</li>
      </ol>
    </section>

    <!-- Main content -->
    <section class="content">
      <div class="row">
        <div class="col-xs-12">
          <div class="nav-tabs-custom">
              <ul class="nav nav-tabs">
                <li class="active"><a href="#Active" data-toggle="tab"><i class="fa fa-plus"></i> Active Customers</a></li>
                <li><a href="#Banned" data-toggle="tab"><i class="fa fa-minus"></i> Banned Customers</a></li>
              </ul>
          <div class="tab-content">

          <div class="tab-pane active " id="Active">
          </br>
            <div class="box-body table-responsive">
              <table id="example2" class="table table-bordered table-hover">
                <thead>
                <tr>
                  <th style="width: 5px">#</th>
                  <th style="width: 250px">Name</th>
                  <th style="width: 150px">Username</th>
				          <th>Status</th>
                  <th>Actions</th>
                </tr>
                </thead>
                <tbody>
                  <% if (re == null || re == undefined){ %>

                  <% }else if (re.length == 0){ %>

                  <% }else{ %>
                   <%  re.forEach(function(i,index){ %>
                      <tr>
                        <td><%=index+1%></td>
                        <td><%= i.strFname%> <%=i.strMname%> <%=i.strLname%></td>
                        <td><%= i.strUsername %></td>
                        <td>
                          <% if (i.Stats == 1){ %>
                            <span class="label label-success">Active</span>
                          <% }else if(i.Stats == 0){ %>
                            <span class="label label-danger">Inactive</span></td>
                          <% }else{ %>
                          <% } %>
                          </td>
                        <td>
                          <center>
                            <!-- <button type="button" data-toggle="modal" data-target="#viewDetails" class="viewDetailsButton large ui teal button" data-custno="<%=i.intUserID%>" data-custsaddress="<%=i.strShippingAddress%>" data-custbaddress="<%=i.strBillingAddress%>" data-custphoneno="<%=i.strCusPhoneNo%>" data-custmobileno="<%=i.strCusMobileNo%>" data-custemail="<%=i.strEmail%>">View</button> -->
                            <button type="button" data-toggle="modal" data-target="#editDetails" class="editDetailsButton large ui button blue" data-custno="<%=i.intUserID%>" data-custfname="<%=i.strFname%>" data-custmname="<%=i.strMname%>" data-custlname="<%=i.strLname%>" data-custsaddress="<%=i.strShippingAddress%>" data-custbaddress="<%=i.strBillingAddress%>" data-custphoneno="<%=i.strCusPhoneNo%>" data-custmobileno="<%=i.strCusMobileNo%>" data-custemail="<%=i.strEmail%>" data-custuname="<%=i.strUsername%>">View</button>
                            <button data-no="<%=i.intUserID%>" onclick="del(<%=i.intUserID%>)" class="large ui red button">Ban</button>
                          </center>
                        </td>
                      </tr>
                    <%  }) %>
                  <% } %>
                </tbody>

              </table>
            </div>
          </div>

            <div class="tab-pane" id="Banned">
            </br>
                <div class="box-body table-responsive">
                  <table id="example_banned" class="table table-bordered table-hover">
                    <thead>
                    <tr>
                      <th style="width: 5px">#</th>
                      <th style="width: 250px">Name</th>
                      <th style="width: 150px">Username</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                      <% if (re2 == null || re2 == undefined){ %>

                      <% }else if (re2.length == 0){ %>

                      <% }else{ %>
                       <%  re2.forEach(function(i,index){ %>
                          <tr>
                            <td><%=index+1%></td>
                            <td><%= i.strFname%> <%=i.strMname%> <%=i.strLname%></td>
                            <td><%= i.strUsername %></td>
                            <td>
                              <% if (i.Stats == 1){ %>
                                <span class="label label-success">Active</span>
                              <% }else if(i.Stats == 2){ %>
                                <span class="label label-danger">Banned</span></td>
                              <% }else{ %>
                              <% } %>
                              </td>
                            <td>
                              <center>
                                <button type="button" data-toggle="modal" data-target="#viewDetails" class="viewDetailsButton large ui teal button" data-custno="<%=i.intUserID%>" data-custsaddress="<%=i.strShippingAddress%>" data-custbaddress="<%=i.strBillingAddress%>" data-custphoneno="<%=i.strCusPhoneNo%>" data-custmobileno="<%=i.strCusMobileNo%>" data-custemail="<%=i.strEmail%>">View</button>
                                <button type="button" data-toggle="modal" data-target="#editDetails" class="editDetailsButton large ui button blue" data-custno="<%=i.intUserID%>" data-custfname="<%=i.strFname%>" data-custmname="<%=i.strMname%>" data-custlname="<%=i.strLname%>" data-custsaddress="<%=i.strShippingAddress%>" data-custbaddress="<%=i.strBillingAddress%>" data-custphoneno="<%=i.strCusPhoneNo%>" data-custmobileno="<%=i.strCusMobileNo%>" data-custemail="<%=i.strEmail%>" data-custuname="<%=i.strUsername%>">Edit</button>
                                <button data-no="<%=i.intUserID%>" onclick="activate(<%=i.intUserID%>)" class="large ui green button">Unban</button>
                              </center>
                            </td>
                          </tr>
                        <%  }) %>
                      <% } %>
                    </tbody>

                  </table>
                </div>
          </div>
        </div>
          <!-- /.box -->

	    </div>
        <!-- /.col -->
      </div>
      <!-- /.row -->
    </section>
    <!-- /.content -->
</div>

  <!-- /.content-wrapper -->

  <!-- Modals -->

  <div class="modal fade" id="viewDetails">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Customer Details</h4>
        </div>
        <div class="modal-body">
            <table id="classTable" class="table table-striped">
                <thead>
                </thead>
                <tbody>
                  <tr>
                    <td>Shipping Address</td>
                    <td>Billing Address</td>
                    <td>Phone Number</td>
                    <td>Mobile Number</td>
                    <td>Email Address</td>
                  </tr>
                  <tr>
                    <td id="view_custsaddress"></td>
                    <td id="view_custbaddress"></td>
                    <td id="view_custphoneno"></td>
                    <td id="view_custmobileno"></td>
                    <td id="view_custemail"></td>
                  </tr>
                </tbody>
              </table>
        </div>
      </div>
    </div>
  </div>


  <div class="modal fade" id="editDetails">
    <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span></button>
      <h4 class="modal-title"></h4>
      </div>
      <div class="modal-body">
      <!-- Horizontal Form -->
          <!-- form start -->
          <form role="form" id="editCustomerDetails">
              <div class="box-body">
                <div class="col-xs-4">

                  <input type="hidden" id="c_no" name="c_no">
                  <label for="cfname">First Name:</label>
                  <input type="text" readonly  class="form-control" name="c_fname" id="c_fname"  >
                </div>

                <div class="col-md-4">
                  <label for="cmname">Middle Name:</label>
                  <input type="text" readonly  class="form-control" id="c_mname" name="c_mname">
                </div>

                <div class="col-md-4">
                  <label for="clname">Last Name:</label>
                  <input type="text" readonly  class="form-control" id="c_lname" name="c_lname">
                </div>

                <div class="form-group input-group col-xs-8">
                  <label for="cuname">Username:</label>
                  <input type="text" readonly  class="form-control" id="c_uname" name="c_uname">
                </div>

                <div class="form-group input-group col-xs-8">
                    <label for="cuname">Email:</label>
                    <input type="text" readonly  class="form-control" id="c_email" name="c_email">
                </div>

                <div class="input-group col-xs-4">
                  <label for="cumno">Mobile Number:</label>
                  <input type="text" readonly id="c_mno" name="c_mno" class="form-control">
                </div>

                <div class="input-group col-xs-4">
                  <label for="cupno">Telephone Number:</label>
                  <input type="text" readonly id="c_pno" name="c_pno" class="form-control">
                </div>

                <div class="form-group input-group col-xs-8">
                  <label for="csaddress">Shipping Address :</label>
                  <input type="text" readonly  class="form-control" id="c_saddress" name="c_saddress">
                </div>


                <div class="form-group input-group col-xs-8">
                  <label for="cbaddress">Billing Address :</label>
                  <input type="text" readonly  class="form-control" id="c_baddress" name="c_baddress">
                </div>

              </div>


      </div>
      <div class="modal-footer">
      <!-- <button type="button" class="big ui button" data-dismiss="modal">Close</button>
      <button type="submit" class="big ui teal button">Save</button> -->
      </div>
      </form>
    </div>
  </div>
<!-- Main Footer -->
<%- include('../../../templates/admin-aside.ejs') -%>

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Create the tabs -->
    <ul class="nav nav-tabs nav-justified control-sidebar-tabs">
      <li class="active"><a href="#control-sidebar-home-tab" data-toggle="tab"><i class="fa fa-home"></i></a></li>
      <li><a href="#control-sidebar-settings-tab" data-toggle="tab"><i class="fa fa-gears"></i></a></li>
    </ul>
    <!-- Tab panes -->
    <div class="tab-content">
      <!-- Home tab content -->
      <div class="tab-pane active" id="control-sidebar-home-tab">
        <h3 class="control-sidebar-heading">Recent Activity</h3>
        <ul class="control-sidebar-menu">
          <li>
            <a href="javascript:;">
              <i class="menu-icon fa fa-birthday-cake bg-red"></i>

              <div class="menu-info">
                <h4 class="control-sidebar-subheading">Langdon's Birthday</h4>

                <p>Will be 23 on April 24th</p>
              </div>
            </a>
          </li>
        </ul>
        <!-- /.control-sidebar-menu -->

        <h3 class="control-sidebar-heading">Tasks Progress</h3>
        <ul class="control-sidebar-menu">
          <li>
            <a href="javascript:;">
              <h4 class="control-sidebar-subheading">
                Custom Template Design
                <span class="pull-right-container">
                    <span class="label label-danger pull-right">70%</span>
                  </span>
              </h4>

              <div class="progress progress-xxs">
                <div class="progress-bar progress-bar-danger" style="width: 70%"></div>
              </div>
            </a>
          </li>
        </ul>
        <!-- /.control-sidebar-menu -->

      </div>
      <!-- /.tab-pane -->
      <!-- Stats tab content -->
      <div class="tab-pane" id="control-sidebar-stats-tab">Stats Tab Content</div>
      <!-- /.tab-pane -->
      <!-- Settings tab content -->
      <div class="tab-pane" id="control-sidebar-settings-tab">
        <form method="post">
          <h3 class="control-sidebar-heading">General Settings</h3>

          <div class="form-group">
            <label class="control-sidebar-subheading">
              Report panel usage
              <input type="checkbox" class="pull-right" checked>
            </label>

            <p>
              Some information about this general settings option
            </p>
          </div>
          <!-- /.form-group -->
        </form>
      </div>
      <!-- /.tab-pane -->
    </div>
  </aside>
  <!-- /.control-sidebar -->
  <!-- Add the sidebar's background. This div must be placed
  immediately after the control sidebar -->
  <div class="control-sidebar-bg"></div>
</div>
<!-- ./wrapper -->


<%- include('../../../templates/admin-footer.ejs') -%>
<script>
  $(function () {
    $('#example2').DataTable({
      'paging'      : true,
      'lengthChange': true,
      'searching'   : true,
      'ordering'    : true,
      'info'        : true,
      'autoWidth'   : true,
	  'select'		: true,
	  'scroll'		: true
    })
  })
</script>

<script>
    $(function () {
      $('#example_banned').DataTable({
        'paging'      : true,
        'lengthChange': true,
        'searching'   : true,
        'ordering'    : true,
        'info'        : true,
        'autoWidth'   : true,
  	  'select'		: true,
  	  'scroll'		: true
      })
    })
  </script>

<script>
$('#title').html("USG | Customers");
$(".treeview a:contains('Maintenance')").parent().addClass("active");
$(".navi a:contains('Customer')").parent().addClass("active");
</script>
<script>
  $('.viewDetailsButton').on('click', function(){
      $('#view_custno').html($(this).data('custno'));
      $('#view_custsaddress').html($(this).data('custsaddress'));
      $('#view_custbaddress').html($(this).data('custbaddress'));
      $('#view_custphoneno').html($(this).data('custphoneno'));
      $('#view_custmobileno').html($(this).data('custmobileno'));
      $('#view_custemail').html($(this).data('custemail'));
  });
</script>

<script>
  function del(value){
    swal({
      title: 'Are you sure?',
      type: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Yes, ban it!',
      reverseButtons: true
    }).then((result) => {
      if (result.value) {
        $.post('/maintenance2/banCustomer',{number: value}, function(data,status){
          if(data){
            swal(
              'Success!',
              'You have banned a customer',
              'success'
            ).then(()=>{
              location.reload();
            })
          }
        })

      }
    })
  }
</script>

<script>
    function activate(value){
      swal({
        title: 'Are you sure?',
        type: 'success',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, unban it!',
        reverseButtons: true
      }).then((result) => {
        if (result.value) {
          $.post('/maintenance2/unbanCustomer',{number: value}, function(data,status){
            if(data){
              swal(
                'Success!',
                'You have unbanned a customer',
                'success'
              ).then(()=>{
                location.reload();
              })
            }
          })

        }
      })
    }
  </script>

<script>
    $('#editCustomerDetails').submit(function(e){
      e.preventDefault();
      $.post('/maintenance/editCustomer',$('#editCustomerDetails').serialize(),(data,success)=>{
        if(data){
          confirm_alert();
        }
      });
    })
</script>
<script>
  $('.editDetailsButton').on('click', function(){
    $('#c_no').val($(this).data('custno'));
    $('#c_fname').val($(this).data('custfname'));
    $('#c_mname').val($(this).data('custmname'));
    $('#c_lname').val($(this).data('custlname'));
    $('#c_uname').val($(this).data('custuname'));
    $('#c_email').val($(this).data('custemail'));
    $('#c_mno').val($(this).data('custmobileno'));
    $('#c_pno').val($(this).data('custphoneno'));
    $('#c_saddress').val($(this).data('custsaddress'));
    $('#c_baddress').val($(this).data('custbaddress'));
  });
</script>


<!-- Optionally, you can add Slimscroll and FastClick plugins.
     Both of these plugins are recommended to enhance the
     user experience. -->
</body>
</html>
