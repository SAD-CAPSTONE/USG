<%- include('../../../templates/navbar.ejs') -%>


<style>
  .x-scrolling-div .simplebar-content {
    min-height: 340px !important;
    width: 100% !important;
  }
  .x-scrolling-div .simplebar-scroll-content {
    overflow-y: hidden !important;
  }
</style>

<div class="mt-3 pt-5 pb-4 text-center bg-secondary text-white banner">
  <div class="container">
    <br>
    <div class="row">
      <div class="col-12">
        <div id="carouselArchitecture" data-ride="carousel" class="carousel slide">
          <ol class="carousel-indicators">
            <li data-target="#carouselArchitecture" data-slide-to="0" class="active"><i></i></li>
            <li data-target="#carouselArchitecture" data-slide-to="1"><i></i></li>
            <li data-target="#carouselArchitecture" data-slide-to="2"><i></i></li>
          </ol>
          <div id="banner-carousel" role="listbox" class="carousel-inner">
            <div class="carousel-item active"><img src="/assets/images/static/organic1.jpg" data-holder-rendered="true" class="d-block img-fluid banner-img" /></div>
            <div class="carousel-item"><img src="/assets/images/static/organic2.jpg" data-holder-rendered="true" class="d-block img-fluid banner-img" /></div>
            <div class="carousel-item"><img src="/assets/images/static/organic3.jpg" data-holder-rendered="true" class="d-block img-fluid banner-img" /></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="mt-4 mb-2">
  <div class="container">
    <div>
      <h3 class="lead fl-l light-bold"><b>Most Popular Products</b></h3>
      <h3 class="lead fl-r"><a href="/store">Go To Store ></a></h3>
    </div><br/><br/>
  </div>
  <div class="container x-scrolling-div" data-simplebar="">
    <% popular.forEach((prod)=>{ %>
      <div class="custom-card my-1" style="margin-right: 22px !important; margin-left: 1px">
        <div class="card-img"><a href="/item"><img src="/assets/images/static/<%= prod.strProductPicture%>"></a></div>
        <div class="cart-button-div">
          <input type="number" class="product-id" value="<%= prod.intProductNo%>" hidden />
          <button type="button" class="cart-btn btn btn-custom-primary p-0 no-focus" data-toggle="modal"
          data-target="#modal-product-to-cart">
          Add to Cart</button>
        </div>

        <div class="card-desc">
          <p class="card-title"><%= prod.strBrand%> <%= prod.strProductName%></p>
          <p class="card-price price-symbol"><%= prod.productPrice%></p>
          <small class="card-oldprice text-muted">
            <span><s class="price-symbol">0</s></span> (-0%)<br>
          </small>
          <small class="card-rating">
            <%
            rating = prod.aveRating;
            for(i=0; i<5; i++){
              if (rating < 1 && rating >= 0.5) {
              %> <i class="fa fa-star-half-o"></i> <%
              } else if (rating < 0.5) {
              %> <i class="fa fa-star-o"></i> <%
              } else {
              %> <i class="fa fa-star"></i> <%
              }
              --rating;
            }%>
            <span class="fs-08em fw-400">(<%= prod.cntRating%>)</span>
          </small>
          <small class="card-reviews"><%= prod.cntReview%> reviews</small>
        </div>
      </div>
      <%})%>
  </div>
</div>
<div class="mb-4">
  <div class="container">
    <div>
      <h3 class="lead fl-l light-bold"><b>New Products</b></h3>
      <h3 class="lead fl-r"><a href="/store">Go To Store ></a></h3>
    </div><br/><br/>
  </div>
  <div class="container x-scrolling-div" data-simplebar="">
    <% popular.forEach((prod)=>{ %>
      <div class="custom-card my-1" style="margin-right: 22px !important; margin-left: 1px">
        <div class="card-img"><a href="/item"><img src="/assets/images/static/<%= prod.strProductPicture%>"></a></div>
        <div class="cart-button-div">
          <input type="number" class="product-id" value="<%= prod.intProductNo%>" hidden />
          <button type="button" class="cart-btn btn btn-custom-primary p-0 no-focus" data-toggle="modal"
          data-target="#modal-product-to-cart">
          Add to Cart</button>
        </div>

        <div class="card-desc">
          <p class="card-title"><%= prod.strBrand%> <%= prod.strProductName%></p>
          <p class="card-price price-symbol"><%= prod.productPrice%></p>
          <small class="card-oldprice text-muted">
            <span><s class="price-symbol">0</s></span> (-0%)<br>
          </small>
          <small class="card-rating">
            <%
            rating = prod.aveRating;
            for(i=0; i<5; i++){
              if (rating < 1 && rating >= 0.5) {
              %> <i class="fa fa-star-half-o"></i> <%
              } else if (rating < 0.5) {
              %> <i class="fa fa-star-o"></i> <%
              } else {
              %> <i class="fa fa-star"></i> <%
              }
              --rating;
            }%>
            <span class="fs-08em fw-400">(<%= prod.cntRating%>)</span>
          </small>
          <small class="card-reviews"><%= prod.cntReview%> reviews</small>
        </div>
      </div>
      <%})%>
  </div>
</div>

<%- include('../../../templates/modal-product-to-cart.ejs') -%>
<%- include('../../../templates/footer.ejs') -%>
<%- include('../../../templates/scripts.ejs') -%>
<script type="text/javascript">
  var t1, t2;
  // GET - Cart Button, Get Modal
  $('.x-scrolling-div').on('click', '.cart-btn', function(){
    let pid = $(this).closest('.custom-card').find('.product-id').val();
    console.log(pid);
    $.get(`/home/modal-cart/${pid}`).then((res) => {
      let data = res.product, modal = $('#modal-product-to-cart');
      modal.find('img').attr("src", data.img);
      modal.find('.title').text(data.name);
      modal.find('.price').text(data.curPrice);
      modal.find('.quantity-input').val(data.curQty);
      modal.find('.select-size').html('');
      data.sizes.forEach((size)=>{
        modal.find('.select-size').append(`<option value="${size}" class='sel'>${size}</option>`);
      })
      modal.find('.select-size').val(data.curSize);
    }).catch((error) => {
      console.log(error);
    });
  });
  // GET - Select Option onchange, Get Price
  $('.select-size').on('change', function(){
    $.get(`/home/modal-cart-price/${this.value}`).then((res) => {
      $('.price').html(`${res.price}`);
    }).catch((error) => {
      console.log(error);
    });
  });
  // GET - Plus Button, Get New Quantity
  $('#modal-product-to-cart').on('click', '.plus-btn', ()=>{
    $.get(`/home/modal-cart-qty/plus`).then((res) => {
      $('#modal-product-to-cart').find('.quantity-input').val(`${res.qty}`);
    }).catch((error) => {
      console.log(error);
    });
  });
  // GET - Minus Button, Get New Quantity
  $('#modal-product-to-cart').on('click', '.minus-btn', ()=>{
    $.get(`/home/modal-cart-qty/minus`).then((res) => {
      $('#modal-product-to-cart').find('.quantity-input').val(`${res.qty}`);
    }).catch((error) => {
      console.log(error);
    });
  });
  // POST - Add to Cart
  $('#modal-product-to-cart').on('click', '.add-button', ()=>{
    let modal = $('#modal-product-to-cart');
    $.post(`/home/modal-cart`).then((res) => {
      clearTimeout(t1);
      clearTimeout(t2);

      let data = res.cart;
      modal.modal('toggle');
      modal.next().css({
        "max-width": "100%",
        "padding": "20px 23px 20px 20px",
        "border-left": "3px solid #00AF6E"
      });
      modal.next().children('div').css("opacity", "1");
      t1 = setTimeout(()=>{
        modal.next().css({
          "max-width": "0",
          "padding": "20px 0px 20px 0px",
          "border-left": "none"
        });
      },5000);
      t2 = setTimeout(()=>{
        modal.next().children('div').css("opacity", "0");
      },4700);

      modal.next().find('span:first-of-type').text(data[data.length-1].curQty);
      modal.next().find('span:nth-of-type(2)').text(data[data.length-1].name);
      modal.next().find('span:nth-of-type(3)').text(data[data.length-1].curSize);
    }).catch((error) => {
      console.log(error);
    });
  });
</script>
<%- include('../../../templates/scripts-customer.ejs') -%>
<%- include('../../../templates/closer.ejs') -%>
