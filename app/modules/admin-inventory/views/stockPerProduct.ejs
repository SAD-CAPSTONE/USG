<%- include('../../../templates/admin-navbar.ejs') -%>


 <!-- Content Wrapper. Contains page content -->

<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>

        <strong><small>Product Code: <%=title[0].strProductCode%> &nbsp; &nbsp; Product Name: <%=title[0].strProductName%></small></strong>
      </h1>
      <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
        <li><a href="#">Maintenance</a></li>
        <li class="active">Inventory</li>
      </ol>
    </section>

    <!-- Main content -->
    <section class="content">
      <div class="row">
        <div class="col-xs-12">
          <div class="box">
            <div class="box-header">
              <h3 class="box-title"></h3>
            </div>
			<!-- buttons -->
				&nbsp; &nbsp;<button type="button" class="btn btn-success btn-sm" data-toggle="modal" data-target="#addProduct"><i class="fa fa-plus"></i> Add New Stock</button>


            <!-- /.box-header -->
            <div class="box-body table-responsive">
              <table id="example2" class="table table-bordered table-hover">
                <thead>
                <tr>
                  <th>Stock No</th>
                  <th>Barcode</th>
                  <th>Expiration Date</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
                </thead>
                <tbody>
                <% if (re == null || re == undefined || re.length == 0) { %>

                <% }else { %>
                  <% re.forEach(function(i){ %>
                    <tr>
                    <td><%=i.intProductQuantityNo%></td>
                    <td><%=i.strBarcode%></td>
                    <td><%= moment(i.expirationDate).format("MMM Do YYYY")%></td>
                    <td><%=i.intStatus%></td>

                    <td><button type="button" data-toggle="modal" data-target="#viewProduct" class="viewButton btn btn-default btn-sm" data-prodno="<%=i.intProductNo%>" data-prodcode="<%=i.strProductCode%>" data-prodname="<%=i.strProductName%>" data-proddesc="<%=i.strDescription%>" data-prodbrand="<%=i.intBrandNo%>" data-prodcateg="<%=i.intSubCategoryNo%>" data-prodpicture="<%=i.strProductPicture%>" >View Details</button>


                    </td>

                  </tr>
                  <% }) %>
                <% } %>

                </tbody>

              </table>
            </div>
            <!-- /.box-body -->
          </div>
          <!-- /.box -->

	    </div>
        <!-- /.col -->
      </div>
      <!-- /.row -->
    </section>
    <!-- /.content -->
</div>

  <!-- /.content-wrapper -->

  <!-- Modals -->

	<div class="modal fade" id="addProduct">
	  <div class="modal-dialog">
		<div class="modal-content">
		  <div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-label="Close">
			  <span aria-hidden="true">&times;</span></button>
			<h4 class="modal-title">Product Information Form</h4>
		  </div>
		  <div class="modal-body">

        <!-- form start -->
        <form role="form" method="post" enctype="multipart/form-data" action="">
          <div class="box-body">

            <div class="form-group">

              <% var number = "1000"; %>
              <% if (list == null || list == undefined || list.length == 0 ) { %>
              <% number = "1000"; %>
              <% }else{ %>
                <% var number = parseInt(list[0].intProductQuantityNo) + 1 %>
                <!-- <input type="text" class="form-control" value="<%=number%>" disabled id="add_prodno" name="add_prodno" > -->

              <% } %>
                <input type="text" class="form-control" value="<%=inventory%>"  id="ino" name="ino" >
                <input type="text" class="form-control" value="<%=number%>"  id="add_prodno" name="add_prodno" >
            </div>
            <div class="form-group">
              <label for="add_bcode">Bar Code</label>
              <input type="text" class="form-control" required id="add_bcode" name="add_bcode" >
            </div>
            <div class="form-group">
              <label for="add_expiration">Expiration Date</label>
              <input type="date" class="form-control" required id="add_expiration" name="add_expiration" >
            </div>




          </div>
          <!-- /.box-body -->

			  <div class="modal-footer">
				<button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
				<button type="button" id="newStock" class="btn btn-primary">Save changes</button>
			  </div>

      </form>
		</div>
  </div>
		<!-- /.modal-content -->
	</div>
</div>

<%- include('../../../templates/admin-aside.ejs') -%>

  <!-- ./wrapper -->

  <!-- REQUIRED JS SCRIPTS -->
  <%- include('../../../templates/admin-footer.ejs') -%>

  <!-- page script (new added) -->
  <script>
    $(function () {
      $('#example2').DataTable({
        'paging'      : true,
        'lengthChange': true,
        'searching'   : true,
        'ordering'    : true,
        'info'        : true,
        'autoWidth'   : true,
  	  'select'		: true,
  	  'scroll'		: true
      })
    })
  </script>

  <script>
    $('.viewButton').on('click', function(){
      $('#view_prodno').val($(this).data('prodno'));
      $('#view_pcode').val($(this).data('prodcode'));
      $('#view_pname').val($(this).data('prodname'));
      $('#view_pdesc').val($(this).data('proddesc'));
      $('#view_prodpic').val($(this).data('prodpic'));
      var filename = "/images/" + $(this).data('prodpicture');
      //alert(filename);
      $('#pic').attr('src',filename);

      var brand = $(this).data('prodbrand');
      $('#view_brand').find('option').each( function() {
        var $this = $(this);
        if ($this.val() == brand) {
           $this.attr('selected','selected');
           return false;
        }
      });

      var categ = $(this).data('prodcateg');
      $('#view_pcat').find('option').each( function() {
        var $this = $(this);
        if ($this.val() == categ) {
           $this.attr('selected','selected');
           return false;
        }
      });

    });
  </script>


  <script>
    $('#title').html("USG | All Products");

    $(".treeview a:contains('Inventory')").parent().addClass("active");
    $(".navi a:contains('All Products')").parent().addClass("active");
  </script>

  <script>
    $(function () {
      $('#example1').DataTable({
        'paging'      : true,
        'lengthChange': true,
        'searching'   : true,
        'ordering'    : true,
        'info'        : true,
        'autoWidth'   : true,
      'select'		: true,
      'scroll'		: true,
      'searching' : true
      })
    })
  </script>

  <script>
    $('.setter').on('click', function(){
      $('#add_sno').val($(this).data('supplierid'));
      $('#add_sname').val($(this).data('supplier'));
      $('#add_bname').val($(this).data('business'));
    })
  </script>

  <script>

  $(document).ajaxStart(function () {
    Pace.restart()

  })
  $(document).ready(function(){
    $('#newStock').on('click',function(){
      $.ajax({
        url: '/inventory/newStock',
        method: 'POST',
        datatype: "json",
        data: {prodno: $('#add_prodno').val(),
              ino: $('#ino').val(),
              barcode: $('#add_bcode').val(),
              expiration: $('#add_expiration').val()
            },
        success: function(response,status,http){
          if (response){
            if (response == "yes"){
              window.location.reload();

            }else{
              swal("Error!", "", "error");
            }
          }
        }
      })
    });
  });
  </script>


  <!-- Optionally, you can add Slimscroll and FastClick plugins.
       Both of these plugins are recommended to enhance the
       user experience. -->
  </body>
  </html>
