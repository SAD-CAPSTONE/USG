<%- include('../../../templates/admin-navbar.ejs') -%>

 <!-- Content Wrapper. Contains page content -->

<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>

        <small>Note: Maintain adjustment types in maintenance section</small>
      </h1>
      <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
        <li><a href="#">Inventory</a></li>
        <li class="active">Adjustments</li>
      </ol>
    </section>

    <!-- Main content -->
    <section class="content">
      <div class="row">
        <div class="col-xs-12">
          <div class="nav-tabs-custom">
            <ul class="nav nav-tabs">
              <li class="active"><a href="#allAdjustments" data-toggle="tab"><i class="fa fa-bars"></i> All Adjustments</a></li>
              <li><a href="#newAdjustment" data-toggle="tab"><i class="fa fa-plus"></i> New</a></li>

            </ul>
            <div class="tab-content">

              <!-- All Adjustments -->
              <div class="tab-pane active" id="allAdjustments">
                <div class="box-body table-responsive">
                  <table id="example1" class="table table-bordered table-hover">
                    <thead>
                      <tr>
                        <th>No</th>
                        <th>Barcode</th>
                        <th>Product Name</th>
                        <th>Quantity</th>
                        <th>Date Adjusted</th>
                        <th>Adjustment Type</th>
                        <th>Details</th>
                      </tr>
                    </thead>
                    <tbody>
                      <% if(all == null || all == undefined){ %>

                      <% }else if(all.length == 0){ %>

                      <% }else{ %>
                      <%  all.forEach(function(i){ %>
                          <tr>
                            <td><%=i.intAdjustmentNo%></td>
                            <td><%=i.strBarcode%></td>
                            <td><%=i.strProductName%></td>
                            <td><%= i.qty %></td>
                            <td><%= moment().format("MM/DD/YYYY")%></td>
                            <td><%=i.strAdjustmentNote%></td>

                          </tr>
                      <%  }) %>
                      <% } %>

                    </tbody>
                  </table>
                </div>

              </div>

              <!-- New Adjustment -->
              <div class="tab-pane" id="newAdjustment">
                <br>
                <div class="row">
                  <div class="col-sm-6">
                    <form id="addItem">
                      <div class="form-group">
                        <label for="barcode">Scan or Enter Barcode:</label>
                        <input class="form-control" id="barcode">
                        <span class="help-block">Please press enter after scanning</span>

                      </div>
                    </form>

                  </div>
                  <div class="col-sm-2">
                    <br>
                    <label for="barcode"></label>
                    <button class="large ui teal button">Choose Item</button>
                  </div>
                </div>
                <br>
                <div class="row">
                  <div class="col-sm-12">
                    <div class="box-body table-responsive">
                      <form id="list_form">
                        <button type="submit" class="large ui brown button">Submit Form </button>
                        <table id="example2" class="table table-bordered table-hover">
                          <thead>
                            <tr>
                              <th style="width: 10px">No</th>
                              <th>Barcode</th>
                              <th>Product Name</th>
                              <th>Quantity</th>
                              <th>Adjustment Type</th>
                              <th>Other Details</th>
                            </tr>
                          </thead>
                          <tbody>


                          </tbody>
                        </table>
                      </form>
                    </div>
                  </div>
                </div>
              </div>

            <!-- /.tab-content -->
          </div>
          <!-- /.nav-tabs-custom -->
          </div>
	      </div>
        <!-- /.col -->
      </div>
      <!-- /.row -->
    </section>
    <!-- /.content -->
</div>

  <!-- /.content-wrapper -->

  <!-- Modals -->


<%- include('../../../templates/admin-aside.ejs') -%>

<!-- ./wrapper -->

<!-- REQUIRED JS SCRIPTS -->

<%- include('../../../templates/admin-footer.ejs') -%>

<!-- page script (new added) -->
<!-- Moment -->
<script src="/assets/admin/bower_components/moment/min/moment.min.js"></script>
<!-- Date range picker -->
<script src="/assets/admin/bower_components/bootstrap-daterangepicker/daterangepicker.js"></script>

<script>
  $(function () {
    $('#example2').DataTable({
      'paging'      : false,
      'lengthChange': true,
      'searching'   : false,
      'ordering'    : true,
      'info'        : false,
      'autoWidth'   : true,
	  'select'		: true,
	  'scroll'		: true
    })
  })
</script>

<script>
  $(function () {
    $('#example1').DataTable({
      'paging'      : true,
      'lengthChange': true,
      'searching'   : true,
      'ordering'    : true,
      'info'        : true,
      'autoWidth'   : true,
	  'select'		: true,
	  'scroll'		: true
    })
  })
</script>


<script>
$(document).ready(function(){

  $('#pull-out').hide();

  //Date range picker
  $('#reservation').daterangepicker();
  $('#search-expired').on('click',function(){

    $.ajax({
      url: '/inventory/searchExpired',
      method: 'post',
      datatype: 'json',
      data: {o: $('#reservation').val()},
      success: function(response,status,http){
        if(response){
          $('#tabl').load('/inventory/showExpired');
        }
      }
    })

  });
})

</script>


<script>
$('#title').html("USG | Adjustments");
$(".treeview a:contains('Inventory')").parent().addClass("active");
$(".navi a:contains('Adjustments')").parent().addClass("active");
</script>

<script>
  $('#list_form').submit(function(e){
    e.preventDefault();

    swal({
      title: 'Are you sure?',
      text: "Please review adjustment list",
      type: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Yes, delete it!',
      reverseButtons: true
    }).then((result) => {
      if (result.value) {
        $.post('/inventory/addAdjustment',$('#list_form').serialize(), function(data,status){
          if(data){
            swal(
              'Success!',
              'You have added an adjustment',
              'success'
            ).then(()=>{
              location.reload();
            })
          }
        })

      }
    })
  })
</script>

<script>

var count = 1;
  $('#addItem').submit(function (e) {
    e.preventDefault();

    var t = $('#example2').DataTable();
    var table = document.getElementById("example2");
    var row = table.getElementsByTagName("tr");
    var rows = t.rows( '.selected' );
    var tr = table.getElementsByTagName("tr");
    var validity = 1;

    $.post('/inventory/getBarcode',{o: $('#barcode').val()},function(data,status){
      if(data == "no"){
        $('#addItem').attr('class', 'form-group has-error');

      }else{
        if (validity){
          $('#addItem').attr('class', 'form-group has-success');

          t.row.add( [
              count,
              `<input style="width: 90px" id="barcodes"required type="text" required name="barcode[]" value="" class="barcode form-control">`,
              '<input style="width: 200px" id="products" required type="text" name="product[]" value="" class="product form-control">',
              '<input style="width: 80px" type="number" name="quantity[]" value="" class="form-control">',
              '<select   required name="type[]" value="" class=" form-control">  <%if(type.length==0){}else{ type.forEach(function(i){ %> <option style="width: 90px" value="<%=i.intAdjustmentTypeNo%>"><%=i.strAdjustment%></option><% })}%>                  </select>',
              '<input style="width: 180px" type="text" required name="note[]"  class=" form-control">'
          ] ).draw( false );
          $('#barcodes').val(data[0].strBarcode);
          $('#products').val(data[0].strProductName);
          $('input.barcode').removeAttr("id");
          $('input.product').removeAttr("id");
          count++;
        }
      }
    })




  } );
</script>


<!-- Optionally, you can add Slimscroll and FastClick plugins.
     Both of these plugins are recommended to enhance the
     user experience. -->
</body>
</html>
