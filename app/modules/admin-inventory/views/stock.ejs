<%- include('../../../templates/admin-navbar.ejs') -%>


<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
  <!-- Content Header (Page header) -->
  <section class="content-header">
    <h1>
      Stocks
      <small></small>

    </h1>
    <ol class="breadcrumb">
      <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
      <li><a href="#">Maintenance</a></li>
      <li class="active">Inventory</li>
    </ol>
  </section>

  <!-- Main content -->
  <section class="content">


    <div class="row">
      <div class="col-xs-12">
        <div class="nav-tabs-custom">
          <ul class="nav nav-tabs">
            <li class="active"><a href="#stock" data-toggle="tab"><i class="fa fa-bars"></i> All Stocks</a></li>
            <li><a href="#addInventory" data-toggle="tab"><i class="fa fa-plus"></i> Add to Stock</a></li>
            <li ><a href="#expired" data-toggle="tab"> Expired Products  &nbsp;<span class="pull-right-container">
              <small class="notifExpired label pull-right bg-red"></small>
              </span></a></li>
            <li ><a href="#critical" data-toggle="tab"> Critical Stocks &nbsp;<span class="pull-right-container">
              <small class="notifCritical label pull-right bg-orange"></small>
              </span></a></li>
          </ul>
          <div class="tab-content">

            <!-- Inventory -->
            <div class="tab-pane active " id="stock">

              <!-- <a data-toggle="modal" data-target="#legend_modal"><i style="font-size: 30px" class="glyphicon glyphicon-info-sign"></i> </a> -->
<!--
                <div class="modal fade" id="legend_modal">
                  <div style="width: 30%;" class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-body">
                      <p >
                      Status Legend <br>
                      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   <a class="ui red circular label"></a> No stock in inventory
                      </br>
                      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a class="ui orange circular label"></a> Reached critical limit
                    </br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <a class="ui green circular label"></a> Enough stock in inventory

                  </br>
                </p>
                    </div>
                  </div>
                </div>
              </div> -->

              </br>
              <!-- /.box-header -->
              <div class="box-body table-responsive">
                <table id="example2" class="table table-bordered table-hover">
                  <thead>
                  <tr>

                    <th>Product Code</th>
                    <th>Product Name</th>
                    <th>Brand</th>
                    <th>Quantity</th>
                    <!-- <th>Status</th> -->
                    <th>Actions</th>
                  </tr>
                  </thead>
                  <tbody>
                  <% if (re == null || re == undefined || re.length == 0) { %>

                  <% }else { %>
                    <% re.forEach(function(i){ %>
                      <tr>

                      <td><%=i.strProductCode%></td>
                      <td><%=i.strProductName%></td>
                      <td><%=i.strBrand%></td>
                      <td><%=i.quantity%></td>
                      <!-- <td>
                        <% if(i.quantity == 0){ %>
                          <a class="ui red circular label"></a>
                        <% }else if(i.quantity < i.intCriticalLimit || i.quantity == i.intCriticalLimit){ %>
                          <a class="ui orange circular label"></a>
                        <% }else{ %>
                          <a class="ui green circular label"></a>
                        <% } %>

                      </td> -->
                      <td>
                        <center>
                        <% var url = i.intProductNo %>
                          <a href="/inventory/productInventory?product=<%=url%>"><button type="button" class="large ui teal button">Inventory</button> </a>
                          <button class="large ui red button"><i class="glyphicon glyphicon-trash"></i></button>
                        </center>
                      </td>

                    </tr>
                    <% }) %>
                  <% } %>

                  </tbody>

                </table>
              </div>
              <!-- /.box-body -->
            </div>


            <!-- New product Item-->
            <div class="tab-pane" id="addInventory">
              <br>
              <br>
              <!-- form start -->
              <form role="form" method="post" enctype="multipart/form-data"  action="/inventory/addToStock">

                <div class="form-group">
                  <div class="row">
                    <div class="col-sm-6">
                      <button type="button" class="large ui green button" data-toggle="modal" data-target="#selectInventory"><i class="fa fa-search"></i> Select Product </button>
                    <p> &nbsp;&nbsp;&nbsp;New product? Click <a data-toggle="modal" data-target="#addProduct">here</a></p>
                    </div>
                  </div>
                </div>

                <div class="form-group">
                  <div class="row">
                    <input type="hidden" class="form-control" required id="ino_name" name="ino_name" >
                    <div class="col-sm-5">
                      <label for="add_pname">Product Name</label>
                      <input type="text" disabled class="form-control" required id="product_name" name="product_name" >
                    </div>
                    <div class="col-sm-4">
                      <label for="add_brand">Brand</label>
                      <input type="text" disabled class="form-control" required id="brand_name" name="brand_name" >
                    </div>
                  </div>
                </div>

                <div class="form-group">
                  <div class="row">
                    <div class="col-sm-5">
                      <label for="add_pname">Batch Number</label>
                      <input type="number" required id="batch" class="form-control" disabled  >
                    </div>
                    <div class="col-sm-4">
                      <label for="add_brand">Price</label>
                      <input type="text" disabled class="form-control" required id="price" name="price" >
                    </div>
                  </div>
                </div>

                <div class="form-group">
                  <div class="row">
                    <div class="col-sm-5">
                      <label for="add_pname">Expiration Date</label>
                      <input type="date" name="expiration" required class="form-control"   >
                    </div>
                    <div class="col-sm-4">
                      <label for="add_pname">Quantity</label>
                      <input type="number" name="quantity" required class="form-control"   >
                    </div>
                  </div>
                </div>

              <div class="box-footer">

                <a href="purchaseOrderList.html"><button type="submit" class="large ui button">Back</button></a>
                <button type="submit" class="large ui teal button">Submit</button>

              </div>
              <!-- /.box-footer -->

                </form>

            </div>


            <!-- Expired -->
            <div class="tab-pane" id="expired">
              <div class="box-body table-responsive">
                <table id="example_expired" class="table table-bordered table-hover">
                  <thead>
                    <tr>
                      <th style="width: 30px"></th>
                      <th>No</th>
                      <th>Barcode</th>
                      <th>Product Name</th>
                      <th>Quantity</th>
                      <th>Brand</th>
                      <th>Supplier</th>
                      <th>Expiration Date</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% if (all == null || all == undefined){ %>

                    <%}else if(all.length==0){ %>

                    <% }else{ %>
                      <% all.forEach(function(i){ %>
                        <tr>
                          <td>
                            <button data-batch="<%=i.intBatchNo%>" class="pulloutitem large ui red basic button">Pull out</button>

                          </td>
                          <td><%=i.intBatchNo%></td>
                          <td><%=i.strBarcode%></td>
                          <td><%=i.strProductName%></td>
                          <td><%=i.intQuantity%></td>
                          <td><%=i.strBrand%></td>
                          <td></td>
                          <td><%=moment(i.expirationDate).format('MM/DD/YYYY')%></td>
                        </tr>
                      <% }) %>
                    <% } %>
                  </tbody>
                </table>
              </div>


            </div>

            <!-- Critical -->
            <div class="tab-pane" id="critical">
              <a href="/purchaseOrder/form" target="_blank" class="large ui green button">Go to purchase order</a>
              <div class="box-body table-responsive">
                <table id="example_critical" class="table table-bordered table-hover">
                  <thead>
                    <tr>
                      <th>Product Name</th>
                      <th>Supplier</th>
                      <th>Size</th>
                      <th>Quantity</th>
                      <th>Critical Limit</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% if (critical == null || critical == undefined){ %>

                    <%}else if(critical.length==0){ %>

                    <% }else{ %>
                      <% critical.forEach(function(i){ %>
                        <tr>
                          <td><%=i.strProductName%></td>
                          <td><%=i.strBusinessName%></td>
                          <td><%=i.intSize%> <%=i.strUnitName%></td>
                          <td><%=i.intQuantity%></td>
                          <td><%=i.intCriticalLimit%></td>
                          <td></td>
                        </tr>
                      <% }) %>
                    <% } %>
                  </tbody>
                </table>
              </div>


            </div>


          </div>
          <!-- /.tab-content -->
        </div>
        <!-- /.nav-tabs-custom -->
      </div>
      <!-- /.col -->
    </div>
    <!-- /.row -->
  </section>
  <!-- /.content -->
</div>
<!-- /.content-wrapper -->


<!-- Modals -->

<div class="modal fade" id="addSupplier">
  <div class="modal-dialog">
  <div class="modal-content">
    <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
      <span aria-hidden="true">&times;</span></button>
    <h4 class="modal-title">Supplier Information Form</h4>
    </div>
    <div class="modal-body">

      <!-- form start -->
      <form role="form" method="post" action="#">
        <div class="box-body">
          <div class="form-group">
            <div class="row">
              <div class="col-xs-4">
                <label for="fname">First Name</label>
                <input type="text" class="form-control" required id="fname" name="fname" >
              </div>
              <div class="col-xs-4">
                <label for="mname">Middle Name</label>
                <input type="text" class="form-control"id="mname" name="mname" >
              </div>
              <div class="col-xs-4">
                <label for="lname">Last Name</label>
                <input type="text" class="form-control" required id="lname" name="lname" >
              </div>
            </div>
          </div>
          <div class="form-group">
            <label for="bname">Business Name</label>
            <input type="text" class="form-control" id="bname" required name="bname" placeholder="">
          </div>
          <div class="form-group">
            <label for="address">Business Address</label>
            <input type="text" class="form-control" id="address" name="address" required placeholder="">
          </div>
          <div class="form-group">
            <div class="row">
              <div class="col-xs-5">
                <label for="mobile">Mobile No.</label>
                <input type="text" class="form-control" id="mobile" name="mobile" >
              </div>
              <div class="col-xs-5">
                <label for="phone">Phone No.</label>
                <input type="text" class="form-control" id="phone" name="phone" >
              </div>
            </div>
          </div>
          <div class="checkbox">
            <label>
              <input type="checkbox">Add supplier to form
            </label>
          </div>
        </div>
        <!-- /.box-body -->


      </div>
      <div class="modal-footer">
      <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
      <button type="submit" class="btn btn-primary">Save</button>
        </form>
      </div>
  </div>
  <!-- /.modal-content -->
</div>
 <!-- /.modal-dialog -->
</div>

  <div class="modal fade" id="selectSupplier">
    <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span></button>
      <h4 class="modal-title">Supplier List</h4>
      </div>
      <div class="modal-body">

      <!-- /.box-header -->
      <div class="box-body table-responsive">
        <table id="example1" class="table table-bordered table-hover">
          <thead>
            <% if (suppliers == null || suppliers == undefined || suppliers.length == 0){ %>
              <h4> No records of Suppliers </h4>
            <% } else { %>
          <tr>
            <th>Supplier No</th>
            <th>Supplier Name</th>
            <th>Business Name</th>
            <th>Action</th>
          </tr>
          </thead>
          <tbody>

            <% suppliers.forEach(function(i){ %>
          <tr>
                <td><%=i.intUserID%></td>
                <td><%=i.strFname%>&nbsp;<%=i.strLname%></td>
                <td><%=i.strBusinessName%></td>
                <td><button data-dismiss="modal" data-supplierid="<%=i.intUserID%>" data-business="<%=i.strBusinessName%>" data-supplier="<%=i.strFname%> <%=i.strLname%>"  class="suppliersetter btn btn-info btn-sm">Select</button></td>

          </tr>
          <% }) %>
        <% } %>


          </tbody>

        </table>
      </div>
      <!-- /.box-body -->

       </div>
        <div class="modal-footer">
        <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
        </div>
    </div>
    <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
 </div>

 <div class="modal fade" id="selectProduct">
   <div class="modal-dialog">
   <div class="modal-content">
     <div class="modal-header">
     <button type="button" class="close" data-dismiss="modal" aria-label="Close">
       <span aria-hidden="true">&times;</span></button>
     <h4 class="modal-title">Product List</h4>
     </div>
     <div class="modal-body">

     <!-- /.box-header -->
     <div class="box-body table-responsive">
       <table id="example3" class="table table-bordered table-hover">
         <thead>
           <% if (products == null || products == undefined || products.length == 0){ %>
              <h4> No records of products </h4>
           <% } else { %>
         <tr>
           <th>Product No</th>
           <th>Product Name</th>
           <th>Brand</th>
           <th>Action</th>
         </tr>
         </thead>
         <tbody>

           <% products.forEach(function(i){ %>
         <tr>
               <td><%=i.intProductNo%></td>
               <td><%=i.strProductName%></td>
               <td><%=i.strBrand%></td>
               <td><button data-dismiss="modal" data-productid="<%=i.intProductNo%>" data-productname="<%=i.strProductName%>" data-pcode="<%=i.strProductCode%>" data-brand="<%=i.strBrand%>" class="productsetter btn btn-info btn-sm">Select</button></td>

         </tr>
         <% }) %>
       <% } %>


         </tbody>

       </table>
     </div>
     <!-- /.box-body -->

      </div>
       <div class="modal-footer">
       <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
       <button type="button" class="btn btn-primary">Save changes</button>
       </div>
   </div>
   <!-- /.modal-content -->
 </div>
 <!-- /.modal-dialog -->
</div>


<div class="modal fade" id="selectInventory">
  <div class="modal-dialog">
  <div class="modal-content">
    <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
      <span aria-hidden="true">&times;</span></button>
    <h4 class="modal-title">Product List</h4>
    </div>
    <div class="modal-body">

    <!-- /.box-header -->
    <div class="box-body table-responsive">
      <table id="inventorytable" class="table table-bordered table-hover">
        <thead>
          <% if (products == null || products == undefined || products.length == 0){ %>
             <h4> No records of products </h4>
          <% } else { %>
        <tr>
          <th style="width: 40%">Product</th>
          <th>Brand</th>
          <th>Price</th>
          <th>Action</th>
        </tr>
        </thead>
        <tbody>

          <% products.forEach(function(i){ %>
        <tr>
              <td><%=i.strProductName%> <%=i.intSize%> <%=i.strUnitName%></td>
              <td><%=i.strBrand%></td>
              <td>₱ <%=i.productPrice.toFixed(2)%></td>
              <td><button data-dismiss="modal" data-inventory="<%=i.intInventoryNo%>" data-product="<%=i.strProductName%> <%=i.intSize%> <%=i.strUnitName%>" data-price="₱ <%=i.productPrice.toFixed(2)%>"  data-brand="<%=i.strBrand%>" class="inventorysetter btn btn-info btn-sm">Select</button></td>

        </tr>
        <% }) %>
      <% } %>


        </tbody>

      </table>
    </div>
    <!-- /.box-body -->

     </div>
      <div class="modal-footer">
      <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
      <button type="button" class="btn btn-primary">Save changes</button>
      </div>
  </div>
  <!-- /.modal-content -->
</div>
<!-- /.modal-dialog -->
</div>




<%- include('../../../templates/admin-aside.ejs') -%>

<!-- ./wrapper -->

<!-- REQUIRED JS SCRIPTS -->

<%- include('../../../templates/admin-footer.ejs') -%>

<!-- Moment -->
<script src="/assets/admin/bower_components/moment/min/moment.min.js"></script>
<!-- Date range picker -->
<script src="/assets/admin/bower_components/bootstrap-daterangepicker/daterangepicker.js"></script>


  <!-- page script (new added) -->

  <script>
  $(document).ready(function(){

    $('#pull-out').hide();

    //Date range picker
    $('#reservation').daterangepicker();
    $('#search-expired').on('click',function(){

      $.ajax({
        url: '/inventory/searchExpired',
        method: 'post',
        datatype: 'json',
        data: {o: $('#reservation').val()},
        success: function(response,status,http){
          if(response){
            $('#tabl').load('/inventory/showExpired');
          }
        }
      })

    });
  })

  </script>

  <script>
    $(function () {
      $('#example2').DataTable({
        'paging'      : true,
        'lengthChange': true,
        'searching'   : true,
        'ordering'    : true,
        'info'        : true,
        'autoWidth'   : true,
  	  'select'		: true,
  	  'scroll'		: true
      })
    })
  </script>

  <script>
    $(function () {
      $('#example3').DataTable({
        'paging'      : true,
        'lengthChange': true,
        'searching'   : true,
        'ordering'    : true,
        'info'        : true,
        'autoWidth'   : true,
      'select'		: true,
      'scroll'		: true
      })
    })
  </script>

  <script>
    $(function () {
      $('#example1').DataTable({
        'paging'      : true,
        'lengthChange': true,
        'searching'   : true,
        'ordering'    : true,
        'info'        : true,
        'autoWidth'   : true,
  	  'select'		: true,
  	  'scroll'		: true
      })
    })
  </script>

  <script>
    $(function () {
      $('#example_expired').DataTable({
        'paging'      : true,
        'lengthChange': true,
        'searching'   : true,
        'ordering'    : true,
        'info'        : true,
        'autoWidth'   : true,
  	  'select'		: true,
  	  'scroll'		: true
      })
    })
  </script>

  <script>
    $(function () {
      $('#example_critical').DataTable({
        'paging'      : true,
        'lengthChange': true,
        'searching'   : true,
        'ordering'    : true,
        'info'        : true,
        'autoWidth'   : true,
      'select'		: true,
      'scroll'		: true
      })
    })
  </script>

  <script>
    $(function () {
      $('#quantity_table').DataTable({
        'paging'      : true,
        'lengthChange': true,
        'searching'   : true,
        'ordering'    : true,
        'info'        : true,
        'autoWidth'   : true,
      'select'		: true,
      'scroll'		: true
      })
    })
  </script>



  <script>
    $(function () {
      $('#inventorytable').DataTable({
        'paging'      : true,
        'lengthChange': true,
        'searching'   : true,
        'ordering'    : true,
        'info'        : true,
        'autoWidth'   : true,
      'select'		: true,
      'scroll'		: true
      })
    })
  </script>

  <script>
    $('.productsetter').on('click', function(){
      $('#add_pno').val($(this).data('productid'));
      $('#add_pname').val($(this).data('productname'));
      $('#add_brand').val($(this).data('brand'));
      $('#add_pcode').val($(this).data('pcode'));
    })
  </script>


  <script>

    $('.inventorysetter').on('click',function(){
      $('#ino_name').val($(this).data('inventory'))
      $('#product_name').val($(this).data('product'))
      $('#brand_name').val($(this).data('brand'))
      $('#price').val($(this).data('price'))

      <% num = "1000" %>
      <% if (lastbatch == undefined || lastbatch == null){ %>

      <% }else if(lastbatch.length == 0){ %>

      <% }else{ %>
      <%   num = parseInt(lastbatch[0].intBatchNo) + 1; %>
      <% } %>
      $('#batch').val("<%=num%>")

    })
  </script>

  <script>
    $('.suppliersetter').on('click', function(){
      $('#add_sno').val($(this).data('supplierid'));
      $('#add_sname').val($(this).data('supplier'));
      $('#add_bname').val($(this).data('business'));

    })
  </script>

  <script>

    $('.pulloutitem').on('click',function(){

      var data = $(this).data('batch');
      swal({
        title: "Are you sure?",
        text: "You cannot undo pullout stock from inventory",
        type: "warning",
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: "Pull-out List from Inventory",
        cancelButtonText: "Back"
      }).then((result)=>{
        if(result.value){

           $.ajax({
             url: '/inventory/pullOutItem',
             method: 'post',
             datatype: "json",
             data: {o: data},
             success: function(response, status, http){
               if(response == "yes"){
                 swal({title: 'Success', text: 'You pulled out items from inventory', type: 'success'}).then(() => {
                   location.reload();
                 })
               }else{
                 swal({title: 'Error', text: 'You have an error', type: 'error'}, function(){
                 })
               }
             }
           })
        }
      })
    });
  </script>


<script>
  $('#title').html("USG | Stocks");

  $(".navi a:contains('Stocks')").parent().addClass("active");

</script>

</body>
</html>
