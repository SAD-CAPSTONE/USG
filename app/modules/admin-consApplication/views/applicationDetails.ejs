<%- include('../../../templates/admin-navbar.ejs') -%>


 <!-- Content Wrapper. Contains page content -->

<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">

      <h1>

        <small></small>

		<small></small>
      </h1>
      <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
        <li><a href="#">Maintenance</a></li>
        <li class="active">Consignor Application</li>
      </ol>
    </section>

    <!-- Main content -->

    <section class="content">

	<div class="alert alert-info alert-dismissible">
                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                <h4><i class="icon fa fa-info"></i>Notice!</h4>
                There are attached files in this application form. Once you approved the application of the consignor, please fill out the details for product sampling and/or demo activity to test the market and get instant feedback from customers.

				</br>

				Upon application, the consignor agreed to replace any goods/products that are about to expire, non-moving, damaged upon delivery or with valid customer complains.
				Also, the consignor would like to actively participate and support any marketing and promotional activities of Ultra Super Green.
              </div>

      <div class="row">
        <div class="col-xs-12">
          <div class="box">
            <div class="box-header">
              <h3 align="center">Consignor Evaluation</h3>
            </div>

        <div class="row">
          <div class="col-md-1"></div>
          <div class="col-md-2">
            <h5>Application Date:</h5>
          </div>
          <div class="col-md-5">
            <h5><%= moment(contract[0].applicationDate).format("MMMM Do YYYY") %></h5>
          </div>
        </div>

        <div class="row">
  				<div class="col-md-1"></div>
  				<div class="col-md-2">
  				  <h5>Business Name:</h5>
  				</div>
  				<div class="col-md-5">
  			    <h5><%=contract[0].strBusinessName%></h5>
  				</div>
			   </div>

			<div class="row">
				<div class="col-md-1"></div>
				<div class="col-md-2">
				<h5>Brands:</h5>
				</div>
				<div class="col-md-5">
				<h5><%=contract[0].strBrands%></h5>
				</div>
			</div>

			<div class="row">
				<div class="col-md-1"></div>
				<div class="col-md-2">
				<h5>Business Type:</h5>
				</div>
				<div class="col-md-5">
				<h5><%= contract[0].strBusinessType %></h5>
				</div>
			</div>

			<div class="row">
				<div class="col-md-1"></div>
				<div class="col-md-2">
				<h5>Business Address:</h5>
				</div>
				<div class="col-md-5">
				<h5><%= contract[0].strBusinessAddress %></h5>
				</div>
			</div>

			<div class="row">
				<div class="col-md-1"></div>
				<div class="col-md-2">
				<h5>Business TIN:</h5>
				</div>
				<div class="col-md-5">
				<h5>
          <% if (contract[0].strBusinessTIN == null){ %>
            <span class="label label-danger">Not Available</span>
          <% }else{ %>
            <%= contract[0].strBusinessTIN %>
          <% } %>
        </h5>
				</div>
			</div>

			<div class="row">
				<div class="col-md-1"></div>
				<div class="col-md-2">
				<h5>Sales Invoice Available:</h5>
				</div>
				<div class="col-md-5">
				<h5>
          <% if (contract[0].intInvoiceAvailable == 0){ %>
            <span class="label label-warning">To be followed</span></h5>
          <% } else if(contract[0].intInvoiceAvailable == 1){ %>
            <span class="label label-success">Available</span></h5>
          <% }else{ %>
            <span class="label label-danger">Not Available</span></h5>
          <% } %>
				</div>
			</div>

			<div class="row">
				<div class="col-md-1"></div>
				<div class="col-md-2">
				<h5>Contact Numbers:</h5>
				</div>
				<div class="col-md-5">
				<h5><%= contract[0].strSupplierMobile %>, <%= contract[0].strSupplierPhone %></h5>
				</div>
			</div>

			<div class="row">
				<div class="col-md-1"></div>
				<div class="col-md-2">
				<h5>Email Address:</h5>
				</div>
				<div class="col-md-5">
				<h5 id="email"><%= contract[0].strBusinessEmail %></h5>
				</div>
			</div>

			<div class="row">
				<div class="col-md-1"></div>
				<div class="col-md-2">
				<h5>Best Time and Day to reach:</h5>
				</div>
				<div class="col-md-5">
				<h5><%= contract[0].timeDayToReach %></h5>
				</div>
			</div>

			<div class="row">
				<div class="col-md-1"></div>
				<div class="col-md-2">
				<h5>Consignment Price:</h5>
				</div>
				<div class="col-md-5">
				<h5>We agree with the <%= contract[0].consignmentPrice %> commission on all product consignment</h5>
				</div>
			</div>

			<div class="row">
				<div class="col-md-1"></div>
				<div class="col-md-2">
				<h5>Product Lines:</h5>
				</div>
				<div class="col-md-5">
				<h5><%= contract[0].strProductLines %></h5>
				</div>
			</div>

			<div class="row">
				<div class="col-md-1"></div>
				<div class="col-md-2">
				<h5>Product Certifications:</h5>
				</div>
				<div class="col-md-5">
				<h5><%= contract[0].strProductCertifications %></h5>
				</div>
			</div>

			<div class="row">
				<div class="col-md-1"></div>
				<div class="col-md-2">
				  <h5>FDA Registration Status:</h5>
				</div>
				<div class="col-md-5">
				  <h5>
            <% if (contract[0].intFDAReg == 0){ %>
              <span class="label label-danger">Not Registered</span>
            <% }else if (contract[0].intFDAReg == 2){ %>
              <span class="label label-warning">To be followed</span>
            <% }else{ %>
              <span class="label label-success">Registered</span>
            <% } %>
          </h5>
				</div>
			</div>

			<div class="row">
				<div class="col-md-1"></div>
				<div class="col-md-2">
				<h5>Proposed Schedule of Delivery:</h5>
				</div>
				<div class="col-md-5">
				<h5><%= moment(contract[0].deliverySchedule).format() %></h5>
				</div>
			</div>

    </br>
    </br>
    </br>

    <h4 align="center">Documents Attached</h4>

      <div class="row">
				<div class="col-md-1"></div>
				<div class="col-md-2">
				<h5>Product Information sheet</h5>
				</div>
				<div class="col-md-5">
				<h5><% if (contract[0].intProductInfoSheet == 0){ %>
          <span class="label label-danger">Not Available</span>
        <% }else{ %>
          <span class="label label-success">Available</span>
        <% } %>
           </h5>
				</div>
			</div>

      <div class="row">
				<div class="col-md-1"></div>
				<div class="col-md-2">
				<h5>Delivery Receipt</h5>
				</div>
				<div class="col-md-5">
				<h5><% if (contract[0].intDeliveryReceipt == 0){ %>
          <span class="label label-danger">Not Available</span>
        <% }else{ %>
          <span class="label label-success">Available</span>
        <% } %>
           </h5>
				</div>
			</div>

      <div class="row">
				<div class="col-md-1"></div>
				<div class="col-md-2">
				<h5>Delivery Receipt</h5>
				</div>
				<div class="col-md-5">
				<h5><% if (contract[0].intDeliveryReceipt == 0){ %>
          <span class="label label-danger">Not Available</span>
        <% }else{ %>
          <span class="label label-success">Available</span>
      <% } %>
          </h5>
				</div>
			</div>

      <div class="row">
				<div class="col-md-1"></div>
				<div class="col-md-2">
				<h5>Company Profile</h5>
				</div>
				<div class="col-md-5">
				<h5><% if (contract[0].intCompanyProfile == 0){ %>
          <span class="label label-danger">Not Available</span>
        <% }else{ %>
          <span class="label label-success">Available</span>
        <% } %>
           </h5>
				</div>
			</div>

      <div class="row">
				<div class="col-md-1"></div>
				<div class="col-md-2">
				<h5>Eco Certification</h5>
				</div>
				<div class="col-md-5">
				<h5><% if (contract[0].intEcoCertification == 0){ %>
          <span class="label label-danger">Not Available</span>
        <% }else{ %>
          <span class="label label-success">Available</span>
        <% } %>
           </h5>
				</div>
			</div>


			<div class="box-footer">
      <a href="consApplication.html"><button class="btn btn-default" >Back</button></a>

      <button type="button" id="sendInvite" data-toggle="modal" data-target="#sendInvitation" class="invite btn btn-success pull-right"><i class="fa fa-envelope"></i> Send Invitation for Product Sampling
				</button>
				<button type="button" onclick="accept(<%=contract[0].intContractNo%>)" class="accept btn btn-primary pull-right" id="accept" style="margin-right: 5px;">
				<i id="checkIcon" class="checkIcon fa fa-check"></i> Accept Consignor
				</button>
        <button type="button" id="reject" onclick="reject(<%=contract[0].intContractNo%>)"  class="reject btn btn-danger pull-right"  style="margin-right: 5px;">
				<i  class=" fa fa-close"></i> Reject Consignor
				</button>
        <button type="button" data-toggle="modal" data-target="#addProduct" class=" btn bg-orange pull-right" id="add"  style="margin-right: 5px;">
				 Add Products
				</button>
			</div>
			<!-- /.box-footer -->



          </div>
          <!-- /.box -->


	    </div>
        <!-- /.col -->
      </div>
      <!-- /.row -->
    </section>
    <!-- /.content -->
</div>

  <!-- /.content-wrapper -->

  <!-- Modals -->

	<div class="modal fade" id="sendInvitation">
	  <div class="modal-dialog">
		<div class="modal-content">
		  <div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-label="Close">
			  <span aria-hidden="true">&times;</span></button>
			<h4 class="modal-title">Invitation Form</h4>
		  </div>
		  <div class="modal-body">
			<!-- Horizontal Form -->

					<!-- form start -->
          <form role="form">
              <div class="box-body">
                <div class="form-group">
                  <label for="receiver">To:</label>
                  <input type="text" class="form-control" id="receiver" disabled value="PICOLE" placeholder="">
                </div>
                <div class="form-group">
                  <label for="exampleInputEmail1">Set Preferred Schedules for Product Presentation:</label>
                  <input type="text" class="form-control" id="exampleInputEmail1" placeholder="ex. June 10, 2018 8:00 onwards">
                </div>
                <div class="form-group">
                  <label for="exampleInputPassword1">Special Note:</label>
                  <textarea class="form-control" id="exampleInputPassword1"> </textarea>
                </div>

                <div class="form-group">
                  <label for="exampleInputFile">Insert PDF for other requirements</label>
                  <input type="file" id="exampleInputFile">

                  <p class="help-block">Include in the requirements the documents to bring.</p>
                </div>
                <!-- <div class="checkbox">
                  <label>
                    <input type="checkbox"> Check me out
                  </label>
                </div> -->
              </div>
            </form>

		  </div>
		  <div class="modal-footer">
			<button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
			<button type="button" data-dismiss="modal" class="sendInvite btn btn-primary">Save changes</button>
		  </div>
		</div>
		<!-- /.modal-content -->
	</div>
  <!-- /.modal-dialog -->
</div>

<div class="modal fade" id="addProduct">
  <div class="modal-dialog">
  <div class="modal-content">
    <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
      <span aria-hidden="true">&times;</span></button>
    <h4 class="modal-title">Add Products</h4>
    </div>
    <div class="modal-body">
    <!-- Horizontal Form -->

        <!-- form start -->
        <form role="form" method="post" action="/consApplication/addConsignorProduct">
            <div class="box-body">
              <h5>Note: Please write product name only, exclude size and price</h5>
              <input type="text" id="consignorNo" name="consignorNo" value="<%=contract[0].intUserID%>">
              <div class="input_fields_wrap">

              <div class="row">
                <div class="col-sm-6"><input class="" required type="text" name="mytext[]"></div>
              </div>
              </div>
            </br>
              <button class="add_field_button btn bg-purple  btn-sm"><i  class=" fa fa-plus"></i></button>
            </div>


    </div>
    <div class="modal-footer">
    <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
    <button type="submit" data-dismiss="modal" class="btn btn-primary">Save changes</button>
      </form>
    </div>
  </div>
  <!-- /.modal-content -->
</div>
<!-- /.modal-dialog -->
</div>


  <!-- Main Footer -->
  <footer class="main-footer">
    <!-- To the right -->
    <div class="pull-right hidden-xs">
      Anything you want
    </div>
    <!-- Default to the left -->
    <strong>Copyright &copy; 2016 <a href="#">Company</a>.</strong> All rights reserved.
  </footer>

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Create the tabs -->
    <ul class="nav nav-tabs nav-justified control-sidebar-tabs">
      <li class="active"><a href="#control-sidebar-home-tab" data-toggle="tab"><i class="fa fa-home"></i></a></li>
      <li><a href="#control-sidebar-settings-tab" data-toggle="tab"><i class="fa fa-gears"></i></a></li>
    </ul>
    <!-- Tab panes -->
    <div class="tab-content">
      <!-- Home tab content -->
      <div class="tab-pane active" id="control-sidebar-home-tab">
        <h3 class="control-sidebar-heading">Recent Activity</h3>
        <ul class="control-sidebar-menu">
          <li>
            <a href="javascript:;">
              <i class="menu-icon fa fa-birthday-cake bg-red"></i>

              <div class="menu-info">
                <h4 class="control-sidebar-subheading">Langdon's Birthday</h4>

                <p>Will be 23 on April 24th</p>
              </div>
            </a>
          </li>
        </ul>
        <!-- /.control-sidebar-menu -->

        <h3 class="control-sidebar-heading">Tasks Progress</h3>
        <ul class="control-sidebar-menu">
          <li>
            <a href="javascript:;">
              <h4 class="control-sidebar-subheading">
                Custom Template Design
                <span class="pull-right-container">
                    <span class="label label-danger pull-right">70%</span>
                  </span>
              </h4>

              <div class="progress progress-xxs">
                <div class="progress-bar progress-bar-danger" style="width: 70%"></div>
              </div>
            </a>
          </li>
        </ul>
        <!-- /.control-sidebar-menu -->

      </div>
      <!-- /.tab-pane -->
      <!-- Stats tab content -->
      <div class="tab-pane" id="control-sidebar-stats-tab">Stats Tab Content</div>
      <!-- /.tab-pane -->
      <!-- Settings tab content -->
      <div class="tab-pane" id="control-sidebar-settings-tab">
        <form method="post">
          <h3 class="control-sidebar-heading">General Settings</h3>

          <div class="form-group">
            <label class="control-sidebar-subheading">
              Report panel usage
              <input type="checkbox" class="pull-right" checked>
            </label>

            <p>
              Some information about this general settings option
            </p>
          </div>
          <!-- /.form-group -->
        </form>
      </div>
      <!-- /.tab-pane -->
    </div>
  </aside>
  <!-- /.control-sidebar -->
  <!-- Add the sidebar's background. This div must be placed
  immediately after the control sidebar -->
  <div class="control-sidebar-bg"></div>
</div>
<!-- ./wrapper -->

<!-- REQUIRED JS SCRIPTS -->

<!-- jQuery 3 -->
<script src="/assets/admin/bower_components/jquery/dist/jquery.min.js"></script>
<!-- Bootstrap 3.3.7 -->
<script src="/assets/admin/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<!-- DataTables (new added)	 -->
<script src="/assets/admin/bower_components/datatables.net/js/jquery.dataTables.min.js"></script>
<script src="/assets/admin/bower_components/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
<!-- SlimScroll -->
<script src="/assets/admin/bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script>
<!-- FastClick -->
<script src="/assets/admin/bower_components/fastclick/lib/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="/assets/admin/dist/js/adminlte.min.js"></script>
<!-- sweetalert  -->
<script src="/assets/bootstrap-sweetalert-master/dist/sweetalert.min.js"></script>
<!-- Notification  -->
<script src="/assets/admin/notification.js"></script>

<!-- page script (new added) -->
<script>
  $(function () {
    $('#example2').DataTable({
      'paging'      : true,
      'lengthChange': true,
      'searching'   : true,
      'ordering'    : true,
      'info'        : true,
      'autoWidth'   : true,
	  'select'		: true,
	  'scroll'		: true
    })
  })
</script>

<script>
  $('.invite').on('click', function(){
    $('#receiver').val($('#email').html());
  });
</script>

<% if (contract[0].intContractStatus == 3){ %>
  <script>
  // for product sampling
    $('.invite').attr('disabled','disabled');

   </script>
<% } %>

<% if (contract[0].intContractStatus == 0 ){ %>
  <script>
  // for pending
    $('#add').hide();
   </script>
<% } %>

<% if ( contract[0].intContractStatus == 1){ %>
  <script>
  // for accepted
    $('.accept').attr('class', 'terminate btn btn-danger pull-right');
    $('#accept').html("Terminate Contract");
    $('.checkIcon').attr('class','fa fa-close');
    $('.invite').attr('disabled','disabled');
    $('#reject').hide();
    $('#add').show();
   </script>
<% } %>

<% if ( contract[0].intContractStatus == 4){ %>
  <script>
  // for terminated
    $('.accept').attr('class', 'terminate btn btn-danger pull-right');
    $('#accept').html("Terminated");
    $('.terminate').attr('disabled','disabled');
    $('.checkIcon').attr('class','fa fa-close');
    $('.invite').attr('disabled','disabled');
    $('#reject').hide();
    $('#add').hide();
   </script>
<% } %>

<% if ( contract[0].intContractStatus == 2){ %>
  <script>
  // for rejected
    $('.accept').attr('class', 'terminate btn btn-danger pull-right');
    $('#accept').html("Rejected");
    $('.terminate').attr('disabled','disabled');
    $('.checkIcon').attr('class','fa fa-close');
    $('.invite').attr('disabled','disabled');
    $('.reject').hide();
    $('#add').hide();
   </script>
<% } %>

<script>

  $('.sendInvite').on('click', function(){
    $.ajax({url:'/consApplication/sendInvitation', method: 'POST' });
    $('.invite').attr('disabled','disabled');
  })
</script>

<script>
  $('#title').html("USG | Consignor Application");
  $(".treeview a:contains('Transactions')").parent().addClass("active");
  $(".navi a:contains('Consignor Application')").parent().addClass("active");
</script>

<script>

  function reject(contract){
    swal({
      title: "Are you sure?",
      text: "You cannot undo this once you rejected the consignor",
      type: "warning",
      showCancelButton: true,
      confirmButtonClass: "btn-danger",
      confirmButtonText: "Reject Consignor",
      cancelButtonText: "Back",
      closeOnConfirm: false,
      closeOnCancel: false
    },
    function(isConfirm){
      if(isConfirm){
        $.ajax({
          url: '/consApplication/reject',
          method: 'post',
          datatype: 'json',
          data: {data: contract},
          success: function(response,status,http){
            if (response == "yes"){
              swal("Rejected!", "You rejected this consignor", "success");
              $('.invite').attr('disabled','disabled');
              $('.accept').attr('class', 'terminate btn btn-danger pull-right');
              $('.terminate').attr('disabled','disabled');
              $('#accept').html('Rejected');
              $('#checkIcon').attr('class','fa fa-close');
              $('#add').hide();
            }
          }
        });
      }else{
        swal("Cancelled", "", "error");

      }
    });
  } // reject function

  function accept(contract){
    var idClass = document.getElementById('accept');


    if(idClass.className == "accept btn btn-primary pull-right"){ // if pending
      swal({
        title: "Are you sure?",
        text: "Please check carefully the documents attached in this application",
        type: "warning",
        showCancelButton: true,
        confirmButtonClass: "btn-primary",
        confirmButtonText: "Accept Consignor",
        cancelButtonText: "Back",
        closeOnConfirm: false,
        closeOnCancel: false
      },
      function(isConfirm) {
        if (isConfirm) {
          $.ajax({
            url:'/consApplication/acceptConsignor',
            method: 'POST',
            datatype: 'json',
            data: {data: contract},
            success: function(response,status,http){
              if (response == "yes"){
                swal("Accepted!", "Please add products to the inventory.", "success");
                $('.invite').attr('disabled','disabled');
                $('.accept').attr('class', 'terminate btn btn-danger pull-right');
                $('#accept').html('Terminate Contract');

                $('#checkIcon').attr('class','fa fa-close');
                $('#reject').hide();
                $('#add').click();
                $('#add').show();
              }
            }
          });
        } else {
          swal("Cancelled", "", "error");
        }
      });

    }else if(idClass.className == "terminate btn btn-danger pull-right"){ // if accepted
      swal({
        title: "Are you sure?",
        text: "You need to pull out stocks if you terminate consignor's contract",
        type: "warning",
        showCancelButton: true,
        confirmButtonClass: "btn-danger",
        confirmButtonText: "Yes, Terminate this contract",
        cancelButtonText: "Back",
        closeOnConfirm: false,
        closeOnCancel: false
      },
      function(isConfirm) {
        if (isConfirm) {
          $.ajax({
            url:'/consApplication/terminateContract',
            method: 'POST',
            datatype: 'json',
            data: {data: contract},
            success: function(response,status,http){
              if (response == "yes"){
                swal("Terminated!", "Please pull out products from the inventory.", "success");
                $('.invite').attr('disabled','disabled');
                $('.accept').attr('class', 'terminate btn btn-danger pull-right');
                $('.terminate').attr('disabled','disabled');
                $('#accept').html('Terminated');
                $('#checkIcon').attr('class','fa fa-close');
                $('#add').hide();
              }
            }
          });

        } else {
          swal("Cancelled", "", "error");
        }
      });
    }else{

    }



  } // end of function
</script>

<script>
$(document).ready(function() {
  var max_fields      = 10; //maximum input boxes allowed
  var wrapper         = $(".input_fields_wrap"); //Fields wrapper
  var add_button      = $(".add_field_button"); //Add button ID

  var x = 1; //initlal text box count
  $(add_button).click(function(e){ //on add input button click
      e.preventDefault();
      if(x < max_fields){ //max input box allowed
          x++; //text box increment
          $(wrapper).append('<div class="row"><div class="col-sm-6"><input required class=""type="text" name="mytext[]"/><a href="#" class="remove_field">&nbsp;Remove</a></div></div>'); //add input box
      }
  });

  $(wrapper).on("click",".remove_field", function(e){ //user click on remove text
      e.preventDefault(); $(this).parent('div').remove(); x--;
  })
});
</script>





<!-- Optionally, you can add Slimscroll and FastClick plugins.
     Both of these plugins are recommended to enhance the
     user experience. -->
</body>
</html>
